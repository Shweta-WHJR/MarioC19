var mario,mario_running,mario_collided;
var obstacles,obstaclesImage,obstaclesGroup;
var obs1,obs2,obs3,obs4;
var brick,brickImage,brickGroup;
var jumpSound,dieSound,ckPntSound;
var ground,groundImage;
var bkgrnd,bkgrndImage;
var PLAY=1;
var END=0;
var gameState=PLAY;
var score=0;
var gameOver,gameOvrImg;
var restart,rsrtImg;
function preload(){
// loading mario animation
  mario_running=loadAnimation("mario00.png","mario01.png","mario02.png","mario03.png") ;
  mario_collided=loadAnimation("collided.png");
// loading obstacles image
  obs1=loadImage("obstacle1.png");
  obs2=loadImage("obstacle2.png");
  obs3=loadImage("obstacle3.png");
  obs4=loadImage("obstacle4.png");
// loading brick image
  brickImage=loadImage("brick.png");
//loading background image
  bckgrndImage=loadImage("bg.png");
// loading ground image
  groundImage=loadImage("ground2.png");
// loading game over image
  gameOvrImg=loadImage("gameOver.png");
// loading restart image
  rsrtImg=loadImage("restart.png");
// loading jump sound
  jumpSound=loadSound("jump.mp3");
// loading sound when mario collides
  dieSound=loadSound("die.mp3");
// loading sound fgor reaching milestone
  ckPntSound=loadSound("checkPoint.mp3");
  
}
function setup(){
  
// creating canvas for game designing
  createCanvas(600,400);
  
// creating a sprite for background and adding image
  rectMode="center"
  bckgrnd=createSprite(300,200,600,400);
  bckgrnd.addImage(bckgrndImage);
  bckgrnd.scale=1.0;
  
// creating mario sprite and adding image
  mario = createSprite(50,350,10,10);
 mario.addAnimation("running",mario_running);
  mario.addAnimation("collided",mario_collided);
  mario.scale=1.5;
  
// creating ground sprites and adding image
  ground=createSprite(0,370,600,3);
  ground.addImage(groundImage);
 ground.x=ground.width/2;
  
// creatring groups for bricks and obstacles
  brickGroup= new Group();
  obstaclesGroup=new Group();
  
// creating a sprite for gameover and adding image
  gameOver=createSprite(270,200,10,10);
  gameOver.addImage(gameOvrImg);
  gameOver.scale=0.5;
  
// creating a sprite for restart and adding image
  restart=createSprite(290,230,10,10);
  restart.addImage(rsrtImg);
  restart.scale=0.5;
  
  //mario.debug=true; setting collider
  mario.setCollider("rectangle",0,0,20,35);
  
}
function draw(){
   background("light blue")
// making mario run on ground
    mario.collide(ground);

//checking the gamestate
    if(gameState===PLAY){
      ground.velocityX=-4;
      if(ground.x<0){
        ground.x=ground.width/2;
      }
// making mario jump on pressing space bar
      if(keyDown("space")&& mario.y>300){
        mario.velocityY=-10;
        jumpSound.play();
      }
// applying gravity
      mario.velocityY=mario.velocityY+0.5;
      score=score+Math.round(getFrameRate()/60);
//spawning bricks and obstacles
      spawnBricks();
      spawnObstacles();
// checking if mario is touching the obstacle
      if(obstaclesGroup.isTouching(mario)){
        dieSound.play();
        gameState=END;
//seting the lifetime so that obstacle and brick does not disappear
        obstaclesGroup.setLifetimeEach(-1);
        brickGroup.setLifetimeEach(-1);

      }
// making gameover and restart invisible
      gameOver.visible=false;
      restart.visible=false;
    }
   else if(gameState===END){
      ground.velocityX=0;
      mario.velocityY=0
 // changing the animation    
 mario.changeAnimation("collided",mario_collided);
// stopping the obstacle and bricks
      obstaclesGroup.setVelocityXEach(0);
      brickGroup.setVelocityXEach(0);
// making gameover and restart visible
      gameOver.visible=true;
      restart.visible=true;
// starting the game after clicking on restart
    if(mousePressedOver(restart)){
      reset();
    }
    }

    //adding milestone sound and increasing difficulty level
    if(score>0 && score%500===0){
        ckPntSound.play();
      ground.velocityX=-(4+score/500);
      obstacles.velocityX=-(6+2*score/500);
      
    }

    drawSprites();
  // displaying the score
    stroke("white");
    textSize(20);
    fill("white");
    text("Score: "+ score, 300,50);
}
function spawnBricks(){
  if(frameCount % 150===0){
    var num = Math.round(random(80,280));
    brick=createSprite(600,num,10,10);
    
    brick.addImage(brickImage);
    brick.velocityX=-3;
    brickGroup.add(brick);
    brick.lifetime=200;
    brick.depth=mario.depth;
    mario.depth=mario.depth+1;
    
  }
}
function spawnObstacles(){
  if(frameCount % 70=== 0){
    
    obstacles=createSprite(550,310,10,10);
    obstacles.velocityX=-6;
    obstacles.lifetime=200;
    obstaclesGroup.add(obstacles);
    var num= Math.round(random(1,4));
    switch(num){
        case 1: obstacles.addImage(obs1);
        break;
        case 2: obstacles.addImage(obs2);
        break;
        case 3: obstacles.addImage(obs3);
        break;
        case 4: obstacles.addImage(obs4);
        break;
        default: break;
    }
  }
}
// declaring a function for reseting 
function reset(){
  gameState=PLAY;
  gameOver.visible=false;
  restart.visible=false;
  mario.changeAnimation("running",mario_running);
  score=0;
  obstaclesGroup.destroyEach();
  brickGroup.destroyEach();
  
}
































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































